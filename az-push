export raw_version=$(az acr repository show-tags --name urkfarma --repository urk-farma --output tsv)
export az_v_docker="${raw_version##*$'\n'}"
arrIN=(${az_v_docker//./ })
export az_v_docker="2.$((${arrIN[1]}+1))"
echo "Pushing version ${az_v_docker}"
echo "Building"
sudo docker build -t olliedev/urk-farma:${az_v_docker}  . --file Dockerfile
docker tag olliedev/urk-farma:${az_v_docker} ${DockerHubUrl}/urk-farma:${az_v_docker}
echo "Pushing to the hub"
docker push ${DockerHubUrl}/urk-farma:${az_v_docker}
echo "Pushing to azure machine"
az container create --resource-group urk-frama --name urk-farma --image ${DockerHubUrl}/urk-farma:${az_v_docker} --cpu 1 --memory 1 --registry-login-server ${DockerHubUrl} --registry-username $DockerHubUsername --registry-password $DockerHubPassword --dns-name-label urk-farma --ports 443 --out table
echo "\nPushed version ${az_v_docker}"
